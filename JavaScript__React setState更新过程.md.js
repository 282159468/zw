(self["webpackChunkzw"]=self["webpackChunkzw"]||[]).push([[8670],{79534:function(e,n,t){"use strict";t.r(n);var a=t(67294),c=t(96089),s=t(65659);t(53132);n["default"]=e=>(a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&c.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.createElement(a.Fragment,null,a.createElement("div",{className:"markdown"},a.createElement("h2",{id:"thissetstatei1"},a.createElement(c.AnchorLink,{to:"#thissetstatei1","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"this.setState(","{","i:1","}",")"),a.createElement("p",null,"setState \u66f4\u65b0\u7684\u5165\u53e3\u5f88\u7b80\u5355\u5c31\u662f\u8c03\u7528\u7ec4\u4ef6\u4e0a\u7684 updater.enqueueSetState \u65b9\u6cd5"),a.createElement(s.Z,{code:"Component.prototype.setState = function(partialState, callback) {\n  this.updater.enqueueSetState(this, partialState, callback, 'setState');\n};",lang:"js"}),a.createElement("h2",{id:"adoptclassinstance"},a.createElement(c.AnchorLink,{to:"#adoptclassinstance","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"adoptClassInstance"),a.createElement("p",null,"updater \u662f\u5728 render phase \u901a\u8fc7 adoptClassInstance \u6dfb\u52a0\u7684"),a.createElement(s.Z,{code:"function adoptClassInstance(workInProgress: Fiber, instance: any): void {\n  instance.updater = classComponentUpdater;\n  workInProgress.stateNode = instance;\n  setInstance(instance, workInProgress);\n}",lang:"js"}),a.createElement("h2",{id:"classcomponentupdater"},a.createElement(c.AnchorLink,{to:"#classcomponentupdater","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"classComponentUpdater"),a.createElement(s.Z,{code:"const classComponentUpdater = {\n  isMounted,\n  enqueueSetState(inst, payload, callback) {\n    const fiber = getInstance(inst);\n    const currentTime = requestCurrentTimeForUpdate();\n    const suspenseConfig = requestCurrentSuspenseConfig();\n    const expirationTime = computeExpirationForFiber(\n      currentTime,\n      fiber,\n      suspenseConfig,\n    );\n\n    const update = createUpdate(expirationTime, suspenseConfig);\n    update.payload = payload;\n    if (callback !== undefined && callback !== null) {\n      update.callback = callback;\n    }\n\n    enqueueUpdate(fiber, update);\n    scheduleUpdateOnFiber(fiber, expirationTime);\n  },\n  enqueueReplaceState(inst, payload, callback) {},\n  enqueueForceUpdate(inst, callback) {},\n};",lang:"js"}),a.createElement("h2",{id:"getinstance"},a.createElement(c.AnchorLink,{to:"#getinstance","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"getInstance"),a.createElement("p",null,"\u901a\u8fc7\u7ec4\u4ef6\u5b9e\u4f8b\u627e\u5230\u5bf9\u5e94\u7684 Fiber\uff0cFiber \u4e5f\u662f\u901a\u8fc7 adoptClassInstance \u4e2d setInstance \u5b58\u5230\u5b9e\u4f8b\u4e0a\u7684"),a.createElement("h2",{id:"createupdate"},a.createElement(c.AnchorLink,{to:"#createupdate","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"createUpdate"),a.createElement("p",null,"\u521b\u5efa\u8fd9\u4e2a\u66f4\u65b0\u5bf9\u8c61 update\uff0cupdate.payload=","{","i:1","}"),a.createElement(s.Z,{code:"// \u51fd\u6570\u7ec4\u4ef6\u66f4\u65b0\u961f\u5217\nexport type FunctionComponentUpdateQueue = {| lastEffect: Effect | null |};\n\n// \u7c7b\u7ec4\u4ef6\u66f4\u65b0\u961f\u5217\nexport type UpdateQueue<State> = {|\n  baseState: State,\n  firstBaseUpdate: Update<State> | null,\n  lastBaseUpdate: Update<State> | null,\n  shared: SharedQueue<State>,\n  effects: Array<Update<State>> | null,\n|};",lang:"js"}),a.createElement("h2",{id:"enqueueupdate"},a.createElement(c.AnchorLink,{to:"#enqueueupdate","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"enqueueUpdate"),a.createElement(s.Z,{code:"export function enqueueUpdate<State>(fiber: Fiber, update: Update<State>) {\n  const updateQueue = fiber.updateQueue;\n  // \u8fd9\u53e5\u8868\u660e\u5728unMount\u5468\u671f\u4e2dsetState({})\u6ca1\u5565\u4f5c\u7528\n  if (updateQueue === null) {\n    // Only occurs if the fiber has been unmounted.\n    return;\n  }\n\n  const sharedQueue: SharedQueue<State> = (updateQueue: any).shared;\n  const pending = sharedQueue.pending;\n  if (pending === null) {\n    // This is the first update. Create a circular list.\n    update.next = update;\n  } else {\n    update.next = pending.next;\n    pending.next = update;\n  }\n  sharedQueue.pending = update;\n}",lang:"js"}),a.createElement("ol",null,a.createElement("li",null,"\u521b\u5efa\u66f4\u65b0\u94fe\u8868 update.next = update \u6216\u8005\u6709\u6b63\u5728\u66f4\u65b0\u7684 update.next = pending.next"),a.createElement("li",null,"\u628a\u66f4\u65b0\u6302\u5230 Fiber \u4e0a fiber.updateQueue.shared.pending = update")),a.createElement("h2",{id:"scheduleupdateonfiber"},a.createElement(c.AnchorLink,{to:"#scheduleupdateonfiber","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"scheduleUpdateOnFiber"),a.createElement("p",null,"\u9996\u6b21\u6e32\u67d3\u65f6\u4e5f\u4f1a\u8fdb\u5165\u8be5\u51fd\u6570\uff0csetState \u8fdb\u5165\u66f4\u65b0\u903b\u8f91\u5206\u652f"))))}}]);