(self["webpackChunkzw"]=self["webpackChunkzw"]||[]).push([[6373],{9231:function(e,t,n){"use strict";n.r(t);var c=n(7294),r=n(6089),a=n(5659);n(3132);t["default"]=e=>(c.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&r.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),c.createElement(c.Fragment,null,c.createElement("div",{className:"markdown"},c.createElement("h2",{id:"react-\u9996\u6b21\u6e32\u67d3-commit-\u9636\u6bb5"},c.createElement(r.AnchorLink,{to:"#react-\u9996\u6b21\u6e32\u67d3-commit-\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"React \u9996\u6b21\u6e32\u67d3 commit \u9636\u6bb5"),c.createElement("p",null,"React render \u9636\u6bb5\u53ea\u662f\u6839\u636e React Element \u521b\u5efa\u597d\u5bf9\u5e94\u7684 Fiber \u6811\uff0c\u5e76\u521d\u59cb\u5316\u597d stateNode \u5b9e\u4f8b\u548c DOM \u76f8\u5173\u7684\u521b\u5efa\u548c\u521d\u59cb\u5316\uff0c\u8be5\u6811\u6307\u5411 RootFiber.alternate\uff0crender \u9636\u6bb5\u5b8c\u6210\u540e\u5c31\u4f1a\u8fdb\u5165 commit \u9636\u6bb5\uff0c\u901a\u8fc7 render \u9636\u6bb5\u521b\u5efa\u7684 Fiber \u6811\u63d0\u4ea4\u771f\u5b9e\u7684 DOM \u8282\u70b9"),c.createElement("h2",{id:"\u83b7\u53d6\u5b8c\u6210\u7684\u4efb\u52a1"},c.createElement(r.AnchorLink,{to:"#\u83b7\u53d6\u5b8c\u6210\u7684\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u5b8c\u6210\u7684\u4efb\u52a1"),c.createElement("p",null,"root.current.alternate"),c.createElement(a.Z,{code:"function performSyncWorkOnRoot(root: FiberRoot) {\n  // render\u9636\u6bb5\u521b\u5efaFiber\n  render();\n\n  // commit\n  // finishedWork\u7684\u5c31\u662frender\u9636\u6bb5\u521b\u5efa\u7684Fiber\u6811\n  const finishedWork: Fiber = (root.current.alternate: any);\n  root.finishedWork = finishedWork;\n  commitRoot(root);\n}",lang:"js"}),c.createElement("h2",{id:"commitroot"},c.createElement(r.AnchorLink,{to:"#commitroot","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"commitRoot"),c.createElement("p",null,"root \u53c2\u6570\u662f FiberRoot"),c.createElement(a.Z,{code:"function commitRoot(root) {\n  const renderPriorityLevel = getCurrentPriorityLevel();\n  runWithPriority(\n    ImmediatePriority,\n    commitRootImpl.bind(null, root, renderPriorityLevel),\n  );\n  return null;\n}",lang:"js"}),c.createElement(a.Z,{code:"let nextEffect = null;\nfunction commitRootImpl(root: FiberRoot) {\n  const finishedWork = root.finishedWork;\n  const firstEffect = finishedWork.firstEffect;\n  nextEffect = firstEffect;\n\n  // \u9012\u5f52\u6267\u884c\u7c7b\u7ec4\u4ef6\u7684getsnaphotbeforeUpdate\n  do {\n    if ((effectTag & Snapshot) !== NoEffect) {\n      commitBeforeMutationEffects();\n    }\n  } while (nextEffect !== null);\n  // \u91cd\u7f6e nextEffect\n  nextEffect = firstEffect;\n}",lang:"js"}),c.createElement("h2",{id:"\u63d0\u4ea4\u6539\u53d8\u524d\u7684\u526f\u4f5c\u7528"},c.createElement(r.AnchorLink,{to:"#\u63d0\u4ea4\u6539\u53d8\u524d\u7684\u526f\u4f5c\u7528","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u63d0\u4ea4\u6539\u53d8\u524d\u7684\u526f\u4f5c\u7528"),c.createElement("p",null,"\u901a\u8fc7\u5224\u65ad effectTag \u662f\u5426\u5305\u542b",c.createElement("code",null,"Snapshot"),"\u526f\u4f5c\u7528\uff0c\u6709\u5219\u9012\u5f52\u6267\u884c\u7c7b\u7ec4\u4ef6\u7684 getsnaphotbeforeUpdate"),c.createElement(a.Z,{code:"function commitBeforeMutationEffects() {\n  while (nextEffect !== null) {\n    instance.getSnapshotBeforeUpdate(\n      // \u8fd9\u91ccelementType\u548ctype\u6709\u4e0d\u76f8\u7b49\u60c5\u51b5\n      finishedWork.elementType === finishedWork.type\n        ? prevProps\n        : resolveDefaultProps(finishedWork.type, prevProps),\n      prevState,\n    );\n    nextEffect = nextEffect.nextEffect;\n  }\n}",lang:"js"}),c.createElement("h2",{id:"\u63d0\u4ea4\u6539\u53d8mutation"},c.createElement(r.AnchorLink,{to:"#\u63d0\u4ea4\u6539\u53d8mutation","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u63d0\u4ea4\u6539\u53d8/Mutation"),c.createElement("p",null,"DOM \u8282\u70b9\u7684\u589e\u3001\u5220\u3001\u6539"),c.createElement("blockquote",null,c.createElement("p",null,"primaryEffectTag = effectTag & (Placement | Update | Deletion | Hydrating)")),c.createElement("p",null,"\u8fd9\u53e5\u610f\u601d\u662f effectTag \u5305\u542b\u54ea\u4e9b\u526f\u4f5c\u7528\uff0c\u6bd4\u5982\u5728\u521b\u5efa Fiber \u6811\u7684\u65f6\u5019\u6709\u4ee5\u4e0b\u4ee3\u7801"),c.createElement(a.Z,{code:"if (typeof instance.componentDidMount === 'function') {\n  workInProgress.effectTag |= Update;\n}",lang:"js"}),c.createElement("p",null,"\u6839\u636e effectTag \u5339\u914d\u5bf9\u5e94\u7684\u5904\u7406"),c.createElement(a.Z,{code:"function commitMutationEffects(root: FiberRoot, renderPriorityLevel) {\n  while (nextEffect !== null) {\n    const effectTag = nextEffect.effectTag;\n    const primaryEffectTag =\n      effectTag & (Placement | Update | Deletion | Hydrating);\n    switch (primaryEffectTag) {\n      case Placement: {\n        commitPlacement(nextEffect);\n        nextEffect.effectTag &= ~Placement;\n        break;\n      }\n      case PlacementAndUpdate: {\n        commitPlacement(nextEffect);\n        nextEffect.effectTag &= ~Placement;\n        const current = nextEffect.alternate;\n        commitWork(current, nextEffect);\n        break;\n      }\n      case Hydrating: {\n        nextEffect.effectTag &= ~Hydrating;\n        break;\n      }\n      case HydratingAndUpdate: {\n        nextEffect.effectTag &= ~Hydrating;\n        const current = nextEffect.alternate;\n        commitWork(current, nextEffect);\n        break;\n      }\n      case Update: {\n        const current = nextEffect.alternate;\n        commitWork(current, nextEffect);\n        break;\n      }\n      case Deletion: {\n        commitDeletion(root, nextEffect, renderPriorityLevel);\n        break;\n      }\n    }\n    nextEffect = nextEffect.nextEffect;\n  }\n}",lang:"js"}),c.createElement("h2",{id:"\u81ea\u7b54\u9898"},c.createElement(r.AnchorLink,{to:"#\u81ea\u7b54\u9898","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u81ea\u7b54\u9898"),c.createElement("ul",{className:"contains-task-list"},c.createElement("li",{className:"task-list-item"},c.createElement("input",{type:"checkbox",disabled:!0})," \u4e3a\u4ec0\u4e48",c.createElement("code",null,"{"," false &&</i> ","}"),"\u4e0d\u4f1a\u663e\u793a false")))))}}]);