(self["webpackChunkzw"]=self["webpackChunkzw"]||[]).push([[9446],{22231:function(e,t,n){"use strict";n.d(t,{m:function(){return a.m}});var a=n(9684);n(72255)},3706:function(e,t,n){"use strict";n.r(t);var a=n(67294),l=n(96089),r=n(72350),c=n(65659),i=n(53132),o=a.memo(i.default["React Hooks - dispatchAction-demo"].component),s=a.memo(i.default["React Hooks - dispatchAction-demo-1"].component);t["default"]=e=>(a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.createElement(a.Fragment,null,a.createElement(a.Fragment,null,a.createElement("div",{className:"markdown"},a.createElement("p",null,"\u6700\u8fd1\u6709\u4e2a\u95ee\u9898\u4e00\u76f4\u6bd4\u8f83\u5934\u75db\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff0c\u95f4\u9699\u6027\u70b9\u51fb div \u8003\u8651",a.createElement("code",null,"render"),"\u7684\u8f93\u51fa\u60c5\u51b5\uff0c\u5373 re-render \u6b21\u6570")),a.createElement(r.default,i.default["React Hooks - dispatchAction-demo"].previewerProps,a.createElement(o,null)),a.createElement("div",{className:"markdown"},a.createElement("p",null,"chrome \u7ed3\u679c\uff1a"),a.createElement("ul",null,a.createElement("li",null,"\u7b2c 1 \u6b21\u70b9\u51fb\u4f1a\u8f93\u51fa",a.createElement("code",null,"render")),a.createElement("li",null,"\u7b2c 2 \u6b21\u70b9\u51fb\u4f1a\u8f93\u51fa",a.createElement("code",null,"render")),a.createElement("li",null,"\u4e4b\u540e\u7684\u70b9\u51fb\u4e0d\u4f1a\u8f93\u51fa",a.createElement("code",null,"render"))),a.createElement("p",null,"\u6709\u70b9\u4e0d\u7b26\u5408\u81ea\u5df1\u7684\u7406\u89e3\uff0c\u9996\u5148 useState \u7684 setXXX \u5176\u5b9e\u6267\u884c\u7684\u662f dispatchAction"),a.createElement("p",null,a.createElement("strong",null,"\u7b2c\u4e8c\u6b21\u70b9\u51fb\u5e94\u8be5\u5c31\u4e0d\u4f1a\u5f15\u8d77\u66f4\u65b0\uff0c\u56e0\u4e3a dispatchAction \u91cc\u6709 is(prev, next)\u5bf9\u6bd4\u524d\u540e\u6570\u636e\uff0c\u76f8\u540c\u5219\u76f4\u63a5\u8fd4\u56de")),a.createElement("p",null,"\u8c03\u8bd5\u53d1\u73b0\u7b2c\u4e8c\u6b21\u6ca1\u6709\u8fdb\u5165\u4e0b\u9762\u8fd9\u4e2a\u5206\u652f\uff0c\u5373\u4e0d\u4f1a\u8fdb\u5165 is \u5bf9\u6bd4\u5206\u652f"),a.createElement(c.Z,{code:"if(fiber.expirationTime === NoWork &&\n    (alternate === null || alternate.expirationTime === NoWork))",lang:"js"}),a.createElement("p",null,"\u8fd9\u91cc\u53cd\u590d\u8c03\u8bd5\u4e86\u5f88\u591a\u6b21"),a.createElement("p",null,a.createElement("del",null,a.createElement("strong",null,"\u8fd9\u6bb5\u4ee3\u7801\u5728 firefox \u4e2d\u6267\u884c\u662f\u7b26\u5408\u9884\u671f\u7684"))),a.createElement("p",null,"\u6000\u7591\u662f chrome \u5b89\u88c5\u4e86 React dev Tools \u63d2\u4ef6\uff0c\u7136\u540e\u5728\u9690\u85cf\u6a21\u5f0f\u4e0b\u6216\u8005\u5220\u9664\u63d2\u4ef6\u6d4b\u8bd5\u95ee\u9898\u4f9d\u65e7"),a.createElement("h2",{id:"\u5206\u6790\u8fc7\u7a0b\u4e00"},a.createElement(l.AnchorLink,{to:"#\u5206\u6790\u8fc7\u7a0b\u4e00","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"\u5206\u6790\u8fc7\u7a0b\u4e00"),a.createElement("p",null,"setCount \u5b9e\u9645\u6267\u884c\u7684 dispatchAction\uff0c\u800c dispatchAction \u662f\u5728\u7ec4\u4ef6\u9996\u6b21\u6e32\u67d3 useState \u4e2d\u7ed1\u5b9a\u7684,\u6240\u4ee5 setCount \u6700\u7ec8\u6267\u884c\u7684\u662f dispatchAction\uff0c",a.createElement("code",null,"dispatchAction"),"\u4e2d\u5bf9\u524d\u540e state \u4f5c\u4e86\u7c7b\u4f3c Object.is(prev, now)\u7684\u5bf9\u6bd4\uff0c\u5373\u5982\u679c setCount \u4f20\u5165\u7684\u503c\u548c\u8fd9\u524d\u76f8\u7b49\uff0c\u662f\u4e0d\u4f1a\u8fdb\u5165\u5230\u8c03\u5ea6",a.createElement("code",null,"schedule"),"\u9636\u6bb5\u7684,\u4e5f\u5c31\u4e0d\u4f1a re-render \u4e86\u3002\u4f46\u662f\u7b2c 2 \u6b21\u4e3a\u4ec0\u4e48\u4f1a re-render?"),a.createElement("p",null,"\u5148\u7406\u4e00\u4e0b dispatchAction \u4ee3\u7801\uff0c\u5165\u53c2\u7684 action \u5176\u5b9e\u5c31\u662f setCount \u7684\u53c2\u6570 1\uff0c\u53e6\u5916 fiber \u548c queue \u662f\u5728\u9996\u6b21\u6e32\u67d3\u65f6 mountState \u662f bind \u7684"),a.createElement(c.Z,{code:"function dispatchAction<S, A>(\n  fiber: Fiber,\n  queue: UpdateQueue<S, A>,\n  action: A,\n) {\n  const eventTime = requestEventTime();\n  const lane = requestUpdateLane(fiber);\n\n  const update: Update<S, A> = {\n    lane,\n    action,\n    eagerReducer: null,\n    eagerState: null,\n    next: (null: any),\n  };\n\n  // Append the update to the end of the list.\n  const pending = queue.pending;\n  if (pending === null) {\n    // This is the first update. Create a circular list.\n    update.next = update;\n  } else {\n    update.next = pending.next;\n    pending.next = update;\n  }\n  queue.pending = update;\n\n  const alternate = fiber.alternate;\n  if (\n    fiber === currentlyRenderingFiber ||\n    (alternate !== null && alternate === currentlyRenderingFiber)\n  ) {\n    // This is a render phase update. Stash it in a lazily-created map of\n    // queue -> linked list of updates. After this render pass, we'll restart\n    // and apply the stashed updates on top of the work-in-progress hook.\n    didScheduleRenderPhaseUpdateDuringThisPass = didScheduleRenderPhaseUpdate = true;\n  } else {\n    // \u7b2c\u4e8c\u6b21\u70b9\u51fb\u6ca1\u6709\u8fdb\u5165\u8fd9\u4e2a\u5206\u652f\n    if (\n      fiber.lanes === NoLanes &&\n      (alternate === null || alternate.lanes === NoLanes)\n    ) {\n      // The queue is currently empty, which means we can eagerly compute the\n      // next state before entering the render phase. If the new state is the\n      // same as the current state, we may be able to bail out entirely.\n      const lastRenderedReducer = queue.lastRenderedReducer;\n      if (lastRenderedReducer !== null) {\n        let prevDispatcher;\n        if (__DEV__) {\n          prevDispatcher = ReactCurrentDispatcher.current;\n          ReactCurrentDispatcher.current = InvalidNestedHooksDispatcherOnUpdateInDEV;\n        }\n        try {\n          const currentState: S = (queue.lastRenderedState: any);\n          const eagerState = lastRenderedReducer(currentState, action);\n          // Stash the eagerly computed state, and the reducer used to compute\n          // it, on the update object. If the reducer hasn't changed by the\n          // time we enter the render phase, then the eager state can be used\n          // without calling the reducer again.\n          update.eagerReducer = lastRenderedReducer;\n          update.eagerState = eagerState;\n          //   \u8fd9\u91cc\u5bf9\u6bd4\u524d\u540estate\n          if (is(eagerState, currentState)) {\n            // Fast path. We can bail out without scheduling React to re-render.\n            // It's still possible that we'll need to rebase this update later,\n            // if the component re-renders for a different reason and by that\n            // time the reducer has changed.\n            return;\n          }\n        } catch (error) {\n          // Suppress the error. It will throw again in the render phase.\n        } finally {\n          if (__DEV__) {\n            ReactCurrentDispatcher.current = prevDispatcher;\n          }\n        }\n      }\n    }\n    scheduleUpdateOnFiber(fiber, lane, eventTime);\n  }\n\n  if (enableSchedulingProfiler) {\n    markStateUpdateScheduled(fiber, lane);\n  }\n}",lang:"js"}),a.createElement(c.Z,{code:"function mountState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  const hook = mountWorkInProgressHook();\n  if (typeof initialState === 'function') {\n    // $FlowFixMe: Flow doesn't like mixed types\n    initialState = initialState();\n  }\n  hook.memoizedState = hook.baseState = initialState;\n  const queue = (hook.queue = {\n    pending: null,\n    dispatch: null,\n    lastRenderedReducer: basicStateReducer,\n    lastRenderedState: (initialState: any),\n  });\n  const dispatch: Dispatch<\n    BasicStateAction<S>,\n  > = (queue.dispatch = (dispatchAction.bind(\n    null,\n    currentlyRenderingFiber,\n    queue,\n  ): any));\n  return [hook.memoizedState, dispatch];\n}",lang:"js"}),a.createElement("p",null,"\u8c03\u8bd5\u4e86\u5f88\u591a\u6b21\u4e86\u6ca1\u6709\u7ed3\u679c\uff0c\u540e\u9762\u53c8\u5207\u5230 React17 \u6d4b\u8bd5\u95ee\u9898\u4f9d\u65e7\uff0c"),a.createElement("p",null,"\u53e6\u5916\u7c7b\u7ec4\u4ef6\u7ee7\u627f PureComponent \u7684\u8868\u73b0\u4e5f\u7b26\u5408\u9884\u671f")),a.createElement(r.default,i.default["React Hooks - dispatchAction-demo-1"].previewerProps,a.createElement(s,null)),a.createElement("div",{className:"markdown"},a.createElement("p",null,"\u53d1\u4e86\u77e5\u4e4e\u63d0\u95ee\u78b0\u4e0b\u8fd0\u6c14",a.createElement(l.Link,{to:"https://www.zhihu.com/question/451642077"},"https://www.zhihu.com/question/451642077")),a.createElement("p",null,a.createElement("strong",null,"\u66f4\u65b0\u4e8e 2021-4-18")),a.createElement("p",null,"firefox \u6267\u884c\u7ed3\u679c\u662f\u548c chrome \u4e00\u81f4\u7684\uff0cfirefox \u4e2d console.log()\u8f93\u51fa\u76f8\u540c\u7684\u5185\u5bb9\uff0c\u6b21\u6570\u4f1a\u6807\u8bb0\u7684\u53f3\u8fb9\uff0c\u4e4b\u524d\u6ca1\u6709\u770b\u5230"),a.createElement("p",null,"\u5f3a\u5927\u7684\u4e71\u4e4e\uff0c\u539f\u6765 React \u5b98\u7f51\u6709\u8fd9\u79cd\u573a\u666f\u7684\u4ecb\u7ecd\uff0c\u602a\u81ea\u5df1\u4e4b\u524d\u6ca1\u6709\u4ed4\u7ec6\u770b\u3002"),a.createElement("blockquote",null,a.createElement("h2",{id:"\u8df3\u8fc7-state-\u66f4\u65b0"},a.createElement(l.AnchorLink,{to:"#\u8df3\u8fc7-state-\u66f4\u65b0","aria-hidden":"true",tabIndex:-1},a.createElement("span",{className:"icon icon-link"})),"\u8df3\u8fc7 state \u66f4\u65b0"),a.createElement("p",null,"\u8c03\u7528 State Hook \u7684\u66f4\u65b0\u51fd\u6570\u5e76\u4f20\u5165\u5f53\u524d\u7684 state \u65f6\uff0cReact \u5c06\u8df3\u8fc7\u5b50\u7ec4\u4ef6\u7684\u6e32\u67d3\u53ca effect \u7684\u6267\u884c\u3002\uff08React \u4f7f\u7528 Object.is \u6bd4\u8f83\u7b97\u6cd5 \u6765\u6bd4\u8f83 state\u3002\uff09"),a.createElement("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cReact \u53ef\u80fd\u4ecd\u9700\u8981\u5728\u8df3\u8fc7\u6e32\u67d3\u524d\u6e32\u67d3\u8be5\u7ec4\u4ef6\u3002\u4e0d\u8fc7\u7531\u4e8e React \u4e0d\u4f1a\u5bf9\u7ec4\u4ef6\u6811\u7684\u201c\u6df1\u5c42\u201d\u8282\u70b9\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684\u6e32\u67d3\uff0c\u6240\u4ee5\u5927\u53ef\u4e0d\u5fc5\u62c5\u5fc3\u3002\u5982\u679c\u4f60\u5728\u6e32\u67d3\u671f\u95f4\u6267\u884c\u4e86\u9ad8\u5f00\u9500\u7684\u8ba1\u7b97\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 useMemo \u6765\u8fdb\u884c\u4f18\u5316\u3002"),a.createElement("p",null,a.createElement(l.Link,{to:"https://reactjs.org/docs/hooks-reference.html#bailing-out-of-a-state-update"},"https://reactjs.org/docs/hooks-reference.html#bailing-out-of-a-state-update"))),a.createElement("p",null,'\u867d\u7136\u6587\u6863\u4e2d\u4ecb\u7ecd\u4e86\u4ea7\u751f\u8fd9\u4e2a\u73b0\u8c61\u7684\u539f\u56e0"React \u53ef\u80fd\u4ecd\u9700\u8981\u5728\u8df3\u8fc7\u6e32\u67d3\u524d\u6e32\u67d3\u8be5\u7ec4\u4ef6"\uff0c\u4f46 React \u8fd9\u6837\u8bbe\u8ba1\u7684\u76ee\u7684\u662f\u4ec0\u4e48\u5462\uff1f'),a.createElement("p",null,"\u7136\u540e\u5728\u8fd9\u4e2a issue \u4e2d React \u6210\u5458\u63d0\u5230\uff0c\u518d\u6b21\u6267\u884c\u7684\u539f\u56e0\u662f\u4e3a\u4e86\u786e\u4fdd\u8df3\u8fc7\u66f4\u65b0\u662f\u5b89\u5168\u7684"),a.createElement("blockquote",null,'This issue doesn\'t look like a "bug" so much as a question for clarification? \ud83d\ude04',a.createElement("p",null,"The next paragraph below the section of the docs you referenced says this:"),a.createElement("p",null,"Note that React may still need to render that specific component again before bailing out. That shouldn\u2019t be a concern because React won\u2019t unnecessarily go \u201cdeeper\u201d into the tree."),a.createElement("p",null,"React bails out early when it knows it's safe to. In some cases, it needs to do a little more work to be sure that it's safe to bail out."),a.createElement("p",null,"The reasons for why this is can't be explained without going fairly deep into the current implementation details- which probably wouldn't be that useful and they're likely to change in an upcoming release as we continue working on new APIs like concurrent mode and suspense."),a.createElement("p",null,"The good news is, as the docs mention, the amount of additional work React does in either case should be small!"),a.createElement("p",null,a.createElement(l.Link,{to:"https://github.com/facebook/react/issues/17672"},"https://github.com/facebook/react/issues/17672"))),a.createElement("p",null,a.createElement("strong",null,"end \u66f4\u65b0\u4e8e 2021-4-18")),a.createElement("ul",{className:"contains-task-list"},a.createElement("li",{className:"task-list-item"},a.createElement("input",{type:"checkbox",defaultChecked:!0,disabled:!0})," \u57fa\u672c\u89e3\u51b3"),a.createElement("li",{className:"task-list-item"},a.createElement("input",{type:"checkbox",disabled:!0})," \u5982\u679c\u4e0d\u518d\u6b21\u6267\u884c\u7ec4\u4ef6\u51fd\u6570\u4f1a\u5f15\u8d77\u4ec0\u4e48\u6837\u7684\u95ee\u9898"))))))}}]);