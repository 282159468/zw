(self["webpackChunkzw"]=self["webpackChunkzw"]||[]).push([[4656],{68546:function(e,n,t){"use strict";t.r(n);var c=t(67294),l=t(96089),a=t(65659);t(53132);n["default"]=e=>(c.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&l.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),c.createElement(c.Fragment,null,c.createElement("div",{className:"markdown"},c.createElement("h1",{id:"useeffect\u8fd1\u4eb2"},c.createElement(l.AnchorLink,{to:"#useeffect\u8fd1\u4eb2","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"useEffect\u8fd1\u4eb2"),c.createElement("blockquote",null,c.createElement("p",null,"Hook \u662f React 16.8 \u7684\u65b0\u589e\u7279\u6027\u3002\u5b83\u53ef\u4ee5\u8ba9\u4f60\u5728\u4e0d\u7f16\u5199 class \u7684\u60c5\u51b5\u4e0b\u4f7f\u7528 state \u4ee5\u53ca\u5176\u4ed6\u7684 React \u7279\u6027\u3002")),c.createElement("h2",{id:"\u5904\u7406\u526f\u4f5c\u7528"},c.createElement(l.AnchorLink,{to:"#\u5904\u7406\u526f\u4f5c\u7528","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u5904\u7406\u526f\u4f5c\u7528"),c.createElement("p",null,"\u5728 React \u652f\u6301 hooks \u4e4b\u524d\uff0c\u901a\u5e38\u4f7f\u7528\u4f7f\u7528\u7c7b\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u5904\u7406\u526f\u4f5c\u7528\uff0c\u8fd9\u6837\u5904\u7406\u7684\u5f0a\u7aef\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u901a\u5e38\u957f\u8fd9\u6837"),c.createElement(a.Z,{code:"class Foo extends React.Component {\n  componentDidMount() {\n    request.get(this.props.id).then(res => {\n      this.setState({ dataSource: res });\n    });\n  }\n\n  componentDidUpdate() {\n    if (xxx) {\n      request.get(this.props.id).then(res => {\n        this.setState({ dataSource: res });\n      });\n    }\n  }\n}",lang:"jsx"}),c.createElement("p",null,"\u5f53\u6709\u4e86 useEffect \u4e4b\u540e\uff0c\u5904\u7406\u526f\u4f5c\u7528\u786e\u5b9e\u65b9\u4fbf\u4e86\u3001\u4f18\u96c5\u4e86"),c.createElement(a.Z,{code:"function Foo() {\n  useEffect(() => {\n    request.get(props.id).then(res => {\n      setState({ dataSource: res });\n    });\n  }, [props.id]);\n\n  return null;\n}",lang:"jsx"}),c.createElement("h2",{id:"\u4ee3\u66ff\u751f\u547d\u5468\u671f"},c.createElement(l.AnchorLink,{to:"#\u4ee3\u66ff\u751f\u547d\u5468\u671f","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u4ee3\u66ff\u751f\u547d\u5468\u671f"),c.createElement("p",null,"\u5728\u8fd9\u6837\u7684\u57fa\u7840\u4e0a\uff0c\u5e73\u65f6\u5de5\u4f5c\u4e2d\u6216\u8005\u7f51\u4e0a\u5927\u5bb6\u7ecf\u5e38\u542c\u5230\u3001\u770b\u5230 useEffect \u4ee3\u66ff\u7c7b\u7ec4\u4ef6\u751f\u547d\u5468\u671f\uff0c\u6bd4\u5982"),c.createElement("ul",null,c.createElement("li",null,"useEffect(fn, []) => componentDidMount"),c.createElement("li",null,"useEffect(fn, [xxx]) => componentDidUpdate")),c.createElement("p",null,"\u4f46\u771f\u7684\u662f\u8fd9\u6837\u4e48\uff1f\u6211\u5728 React \u9762\u8bd5\u65f6\u7ecf\u5e38\u4f1a\u95ee\u7684\u4e00\u4e2a\u95ee\u9898\uff1a"),c.createElement("p",null,"\u9875\u9762\u4e2d\u6709\u5982\u4e0b\u7ec4\u4ef6\uff0c\u95ee\u5f53\u6253\u5f00\u9875\u9762\u65f6 5s \u4e4b\u524d\u80fd\u770b\u5230 render \u8fd4\u56de\u7684\u5185\u5bb9\u5417\uff1f"),c.createElement(a.Z,{code:"import React from 'react';\nconst delay = (time = 5000) => {\n  let now = Date.now();\n  const start = now;\n  while (now - start < time) {\n    now = Date.now();\n  }\n};\nclass Foo extends React.Component {\n  componentDidMount() {\n    delay();\n  }\n  render() {\n    return <div>Hi zw</div>;\n  }\n}\nexport default Foo;",lang:"jsx"}),c.createElement("p",null,"\u7ed3\u679c 90%+\u7684\u5019\u9009\u4eba\u90fd\u56de\u7b54\u80fd\u770b\u5230\uff0c\u7406\u7531\u65f6 componentDidMount \u751f\u547d\u5468\u671f\u662f DOM \u8282\u70b9\u5df2\u88ab\u6dfb\u52a0\u5230\u9875\u9762\u4e2d\u540e\u6267\u884c\u7684\uff0c\u4f46\u5b9e\u9645\u5e76\u4e0d\u80fd\u770b\u5230"),c.createElement("p",null,"\u4f46\u662f\u5982\u679c\u7528\u4e0b\u9762\u7684\u8fd9\u6837\u7684\u4ee3\u7801\u4ee3\u66ff\uff0c\u4f30\u8ba1\u90fd\u80fd\u56de\u7b54\u6b63\u786e\uff0c\u5176\u5173\u952e\u5c31\u662f\u540c\u6b65+\u5355\u7ebf\u7a0b\uff0c\u867d\u7136 render \u5df2\u7ecf\u628a DOM \u8282\u70b9\u6dfb\u52a0\u5230 body \u4e86\uff0c\u4f46\u662f\u540e\u7eed\u7684 delay \u4e00\u76f4\u5360\u7528\u7ebf\u7a0b\uff0c\u5bfc\u81f4 GUI \u7ebf\u7a0b\u65e0\u6cd5\u6e32\u67d3\u76f8\u5e94\u7684 DOM \u8282\u70b9"),c.createElement(a.Z,{code:"const delay = (time = 5000) => {\n  let now = Date.now();\n  const start = now;\n  while (now - start < time) {\n    now = Date.now();\n  }\n};\nconst render = () => {\n  const ele = document.createElement('span');\n  ele.appendChild(document.createTextNode('Hi zw'));\n  document.body.appendChild(ele);\n};\nconst componentDidMount = () => {\n  delay();\n};\n\nrender();\ncomponentDidMount();",lang:"js"}),c.createElement("p",null,"\u4e0b\u9762\u7528 useEffect \u6a21\u62df componentDidMount \u5b9e\u73b0\u4e0a\u9762\u7684\u573a\u666f\uff0c\u770b\u5982\u679c\u662f\u5982\u4f55\u7684\uff1f"),c.createElement(a.Z,{code:"import React, { useEffect } from 'react';\nconst delay = (time = 5000) => {\n  let now = Date.now();\n  const start = now;\n  while (now - start < time) {\n    now = Date.now();\n  }\n};\nconst Foo = () => {\n  useEffect(() => {\n    delay();\n  }, []);\n  return <div>Hi zw</div>;\n};\nexport default Foo;",lang:"jsx"}),c.createElement("p",null,"\u7ed3\u679c\u6253\u5f00\u9875\u9762\u540e\u4f1a\u770b\u5230 DOM \u88ab\u6e32\u67d3\u4e86\uff0cuseEffect \u5b98\u65b9\u662f\u8fd9\u6837\u5b9a\u4e49\u7684"),c.createElement("h2",{id:"useeffect"},c.createElement(l.AnchorLink,{to:"#useeffect","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"useEffect"),c.createElement("blockquote",null,c.createElement("p",null,"\u4f7f\u7528 useEffect \u5b8c\u6210\u526f\u4f5c\u7528\u64cd\u4f5c\u3002\u8d4b\u503c\u7ed9 useEffect \u7684\u51fd\u6570\u4f1a\u5728\u7ec4\u4ef6\u6e32\u67d3\u5230\u5c4f\u5e55\u4e4b\u540e\u6267\u884c\u3002\u4f60\u53ef\u4ee5\u628a effect \u770b\u4f5c\u4ece React \u7684\u7eaf\u51fd\u6570\u5f0f\u4e16\u754c\u901a\u5f80\u547d\u4ee4\u5f0f\u4e16\u754c\u7684\u9003\u751f\u901a\u9053\u3002")),c.createElement("p",null,"\u7b7e\u540d\uff1a"),c.createElement(a.Z,{code:"function useEffect(effect: EffectCallback, deps?: DependencyList): void;",lang:"ts"}),c.createElement("p",null,"\u56e0\u4e3a\u53ef\u4ee5\u7406\u89e3 useEffect \u7684\u56de\u8c03\u51fd\u6570\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0c\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a"),c.createElement(a.Z,{code:"const render = () => {\n  // ...\n};\nconst effectCallback = () => {\n  delay();\n};\n\nrender();\nsetTimeout(effectCallback);",lang:"js"}),c.createElement("p",null,"\u8fd9\u6837 useEffect \u5c31\u4e0d\u4f1a\u963b\u585e\u9875\u9762\u7684\u6e32\u67d3\uff0c\u8fd9\u662f\u5b83\u7684\u4f18\u70b9\uff0c\u4f46\u662f\u7531\u4e8e\u4f1a\u6e32\u67d3\u591a\u6b21\uff0c\u5728\u67d0\u4e9b\u573a\u666f\u4f1a\u53d8\u6210\u7f3a\u70b9\uff0c\u6bd4\u5982\u5728\u505a\u4e00 DOM \u8282\u70b9\u6837\u5f0f\u3001\u4f4d\u7f6e\u7b49\u4fe1\u606f\u6e32\u67d3\u65f6\u5c31\u4f1a\u51fa\u73b0\u6296\u52a8\u7684\u60c5\u51b5\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528 useLayoutEffect"),c.createElement("h2",{id:"uselayouteffect"},c.createElement(l.AnchorLink,{to:"#uselayouteffect","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"useLayoutEffect"),c.createElement("blockquote",null,c.createElement("p",null,"\u5176\u51fd\u6570\u7b7e\u540d\u4e0e useEffect \u76f8\u540c\uff0c\u4f46\u5b83\u4f1a\u5728\u6240\u6709\u7684 ",c.createElement("strong",null,"DOM \u53d8\u66f4\u4e4b\u540e\u540c\u6b65\u8c03\u7528 effect"),"\u3002\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8bfb\u53d6 DOM \u5e03\u5c40\u5e76\u540c\u6b65\u89e6\u53d1\u91cd\u6e32\u67d3\u3002\u5728\u6d4f\u89c8\u5668\u6267\u884c\u7ed8\u5236\u4e4b\u524d\uff0cuseLayoutEffect \u5185\u90e8\u7684\u66f4\u65b0\u8ba1\u5212\u5c06\u88ab\u540c\u6b65\u5237\u65b0\u3002")),c.createElement("p",null,"\u52a0\u7c97\u90e8\u5206\u7ffb\u8bd1\u4e3a\uff1a"),c.createElement(a.Z,{code:"render();\neffectCallback();",lang:"js"}),c.createElement("h2",{id:"\u603b\u7ed3"},c.createElement(l.AnchorLink,{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},c.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),c.createElement("ul",null,c.createElement("li",null,"useEffect(cb, [])\u5e76\u4e0d\u662f componentDidMount\uff0cuseLayoutEffect \u548c componentDidMount \u66f4\u76f8\u8fd1"),c.createElement("li",null,"useEffect \u662f\u5728 DOM \u6dfb\u52a0\u5230\u9875\u9762\uff0c\u5e76\u4e14\u6d4f\u89c8\u5668\u5b8c\u6210\u6e32\u67d3\u540e\u624d\u6267\u884c\u7684\uff0cuseLayoutEffect \u662f\u5728 DOM \u6dfb\u52a0\u5230\u9875\u9762\u540c\u6b65\u8c03\u7528\u7684\uff0c\u6240\u4ee5\u4f1a\u963b\u585e\u9875\u9762\u6e32\u67d3")))))}}]);